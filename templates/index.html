<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Plex Config</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <div class="header-container">
        <img src="{{ url_for('static', filename='images/header.png') }}" alt="Header Image" class="header-image">
    </div>
    <h1>Enter Configuration Information</h1>
    <form id="configForm">
        <!-- Plex Section -->
        <h2>Plex Settings</h2>
        <label for="plex_url">Plex URL:</label>
        <input type="text" id="plex_url" name="plex_url" required>
        
        <label for="plex_token">Plex Token:</label>
        <input type="text" id="plex_token" name="plex_token" required>
        
        <label for="plex_dbcache">DB Cache (>= 40):</label>
        <input type="number" id="plex_dbcache" name="plex_dbcache" min="40" required>
        
        <label for="plex_timeout">Timeout (>= 5):</label>
        <input type="number" id="plex_timeout" name="plex_timeout" min="5" required>
        
        <div class="checkbox-container">
            <label for="plex_verify_ssl">Verify SSL:</label>
            <input type="checkbox" id="plex_verify_ssl" name="plex_verify_ssl">
        </div>
        
        <div class="checkbox-container">
            <label for="plex_clean_bundles">Clean Bundles:</label>
            <input type="checkbox" id="plex_clean_bundles" name="plex_clean_bundles">
        </div>
        
        <div class="checkbox-container">
            <label for="plex_empty_trash">Empty Trash:</label>
            <input type="checkbox" id="plex_empty_trash" name="plex_empty_trash">
        </div>
        
        <div class="checkbox-container">
            <label for="plex_optimize">Optimize:</label>
            <input type="checkbox" id="plex_optimize" name="plex_optimize">
        </div>

        <!-- TMDb Section -->
        <h2>TMDb Settings</h2>
        <label for="tmdb_apikey">TMDb API Key:</label>
        <input type="text" id="tmdb_apikey" name="tmdb_apikey" required>
        
        <label for="tmdb_language">Language (ISO 639-1 Code):</label>
        <input type="text" id="tmdb_language" name="tmdb_language" required>
        
        <label for="tmdb_region">Region (ISO 3166-1 Code):</label>
        <input type="text" id="tmdb_region" name="tmdb_region" required>
        
        <label for="tmdb_cache_expiration">Cache Expiration (days):</label>
        <input type="number" id="tmdb_cache_expiration" name="tmdb_cache_expiration" required>
        
        <input type="submit" value="Submit">
    </form>
    <div class="messages">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <ul>
              {% for category, message in messages %}
                <li class="{{ category }}">{{ message }}</li>
              {% endfor %}
            </ul>
          {% endif %}
        {% endwith %}
    </div>
    <script>
        document.getElementById('configForm').onsubmit = function(event) {
            event.preventDefault();
            if (confirm('Are you sure you want to submit the form?')) {
                const formData = new FormData(this);
                fetch('/submit', {
                    method: 'POST',
                    body: formData
                }).then(response => response.json())
                .then(data => {
                    const messagesDiv = document.querySelector('.messages');
                    messagesDiv.innerHTML = '';
                    const ul = document.createElement('ul');
                    messagesDiv.appendChild(ul);
                    data.messages.forEach(msg => {
                        const li = document.createElement('li');
                        li.textContent = msg.text;
                        li.className = msg.category;
                        ul.appendChild(li);
                    });
                });
            }
        };
    </script>
</body>
</html>